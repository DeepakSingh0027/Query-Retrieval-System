import fs from "fs";
import path from "path";
import { fileURLToPath } from "url";
import Pdf from "./lib/pdf-parse.js"; // Make sure this file is also ES module-compatible

export default Pdf;

// For testing purpose
if (import.meta.url === `file://${process.argv[1]}`) {
  const __filename = fileURLToPath(import.meta.url);
  const __dirname = path.dirname(__filename);

  // Use absolute path relative to the current file
  const PDF_FILE = new URL("./test/data/05-versions-space.pdf", import.meta.url).pathname;


  try {
    const dataBuffer = fs.readFileSync(PDF_FILE);

    Pdf(dataBuffer).then((data) => {
      fs.writeFileSync(`${PDF_FILE}.txt`, data.text, {
        encoding: "utf8",
        flag: "w",
      });
      debugger;
    }).catch((err) => {
      console.error("Error during PDF parsing:", err);
      debugger;
    });

  } catch (err) {
    console.error("File not found or can't be read:", err.message);
  }
}
